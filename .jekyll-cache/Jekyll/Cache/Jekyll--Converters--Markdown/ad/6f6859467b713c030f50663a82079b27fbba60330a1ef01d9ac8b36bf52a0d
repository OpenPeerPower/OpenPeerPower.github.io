I"≥<p>This article guides your through the configuration of Tor to provide a secure access to your Open Peer Power instance as an Onion site, through <a href="https://www.torproject.org/docs/hidden-services.html.en">Tor‚Äôs Hidden Service</a> feature, from remote. With this enabled, you do not need to open your firewall ports or setup HTTPS to enable secure remote access.</p>
<p>This is useful if you want to have:</p>
<ul>
<li>Access your Open Peer Power instance remotely without opening a firewall port or setting up a VPN.</li>
<li>Don‚Äôt want to or know how to get an SSL/TLS certificate and HTTPS configuration setup.</li>
<li>Want to block attackers from even being able to access/scan your port and server at all.</li>
<li>Want to block anyone from knowing your home IP address and seeing your traffic to your Open Peer Power.</li>
</ul>
<h2>Hidden Services and Onion Sites</h2>
<p>Tor allows clients and relays to offer hidden services. That is, you can offer a web server, SSH server, etc., without revealing your IP address to its users. In fact, because you don‚Äôt use any public address, you can run a hidden service from behind your firewall. Learn more about Hidden Services on the <a href="https://www.torproject.org/docs/tor-hidden-service.html.en">Tor Project website</a>.</p>
<p>Onion sites are websites that run on a Tor Hidden Service node. ‚Äúdot onion‚Äù sites are an <a href="https://datatracker.ietf.org/doc/rfc7686/">IETF recognized special use domain name</a>.</p>
<h2>Setting up Tor on your Open Peer Power</h2>
<p>First, install Tor. On a Debian-based system, you can install the package easily:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">$ sudo apt-get install tor</code></pre></figure>
<p>You can find more instructions for downloading and installing Tor on other platforms on the <a href="https://www.torproject.org/download/download.html">Tor Project Download Page</a>.</p>
<p>Next, modify Tor‚Äôs main configuration file <code>/etc/tor/torrc</code> to include the following lines:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">############### This section is just for location-hidden services ###
<h2>Once you have configured a hidden service, you can look at the</h2>
<h2>contents of the file &quot;‚Ä¶/hidden_service/hostname&quot; for the address</h2>
<h2>to tell people.</h2>
<p>‚Ä¶
HiddenServiceDir /var/lib/tor/openpeerpower/
HiddenServicePort 80 127.0.0.1:8123
HiddenServiceAuthorizeClient stealth haremote1
‚Ä¶</code></pre></figure></p>
<p>The ‚Äústealth‚Äù entry above ensures traffic to and from your Open Peer Power instance over Tor, is hidden even from other nodes on the Tor network. The <code>haremote1</code> value is a generic client name entry that you can modify as you please.</p>
<p>Then, restart Tor:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">$ sudo systemctl restart tor</code></pre></figure>
<p>Then read the new generated authentication cookie from the Tor-generated hostname file:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">$ sudo more /var/lib/tor/openpeerpower/hostname</code></pre></figure>
<p>The output of that command should look something like this, but with your own unique ‚Äúdot onion‚Äù domain and authentication cookie:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">abcdef1234567890.onion ABCDEF1122334455667789 # client: haremote1</code></pre></figure>
<p>You are now done with the Open Peer Power Tor server configuration. Make sure your Open Peer Power instance is running, and now you can move to client configuration.</p>
<h2>Tor Client Access Setup</h2>
<p>Using this setup, you can access your Open Peer Power instance over Tor from your laptop or mobile device, using Tor Browser and other software.</p>
<p>Add the authentication cookie to your <code>torrc</code> client configuration on your laptop or mobile device. Using the sample values from above, it would look like this:</p>
<figure class="highlight"><pre><code class="language-bash" data-lang="bash">HidServAuth abcdef1234567890.onion ABCDEF1122334455667789</code></pre></figure>
<p>For Tor Browser on Windows, Mac or Linux, you can find the torrc file here: <code>&lt;tor browser install directory&gt;/Browser/TorBrowser/Data/Tor/torrc</code></p>
<p>Once you have added the entry, restart the browser, and then browse to the ‚Äúdot onion‚Äù site address to connect to your Open Peer Power instance.</p>
<p>For <a href="https://guardianproject.info/apps/orbot">Orbot: Tor on Android</a>, add it in <strong>Orbot</strong> -&gt; <strong>Menu</strong> -&gt; <strong>Settings</strong> to the ‚ÄúTorrc Custom Configuration‚Äù entry. Restart Orbot, and then use the <a href="https://guardianproject.info/apps/orfox/">Orfox browser app</a>, and browse to the ‚Äúdot onion‚Äù site name to access your Open Peer Power instance. You can also use Orbot‚Äôs VPN mode, to enable Tor access from any application on your device, such as Tasker or Owntracks.</p>
<p>On iOS, we have not fully tested this yet, but you should be able to add custom torrc entries on <a href="https://mike.tig.as/onionbrowser/">Onion Browser</a>, Red Onion or TOBY browsers, all available in the iTunes App Store.</p>
<h2>Some More Advanced Ideas</h2>
<p>With this configuration, only you can access your Open Peer Power instance Onion site through Tor, and no one else. You can share the authentication cookie with multiple devices and users, or you can generate a unique one for each - up to you! If you have multiple, say for an industrial, business or corporate configuration, this would provide an easy way to revoke access to a specific user or device.</p>
<p>If you always access your Open Peer Power instance via Tor, you can easily run this on an isolated ‚ÄúIoT‚Äù network segment at your install site, keeping your internal home network traffic separate from any potentially compromised devices (like cheap ‚Äúsmart‚Äù lightbulbs with backdoors!).</p>
<p>You could also use Tor as a means to connect your Open Peer Power instance to a remote device, sensor or other service that you do not want to or connect provide a direct, open IP connection to. Again, Tor provides authenticated and confidential routing (aka ‚Äúprivacy and encryption‚Äù) by default, without having to setup TLS/SSL or VPN. It is just important to secure IoT nodes within your network, as it is to secure remote access!</p>
<p>As mentioned, with Orbot on Android, you can enable a ‚Äúfull device‚Äù VPN mode, that allows any app you have to tunnel through Tor, even if it is not Tor or proxy aware. This means you should be able to enter your ‚Äúdot onion‚Äù Onion site address into any app you want to access to your Open Peer Power instance, and it should work.</p>
:ET