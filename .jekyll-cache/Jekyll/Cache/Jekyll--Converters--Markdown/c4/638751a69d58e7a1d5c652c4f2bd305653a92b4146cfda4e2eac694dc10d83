I"⁄<p>The <a href="https://developer.apple.com/homekit/">HomeKit</a> controller integration allows you to connect accessories with the ‚ÄúWorks with HomeKit‚Äù logo to Open Peer Power. This integration should not be confused with the <a href="/integrations/homekit/">HomeKit</a> integration, which allows you to control Open Peer Power devices via HomeKit.</p>
<p>The integration will automatically detect HomeKit compatible devices that are ready to pair if the <a href="/integrations/zeroconf/"><code>zeroconf</code></a> integration is enabled. This is enabled by default on new installations via the <a href="/integrations/default_config/"><code>default_config</code></a> component.</p>
<p>To see which devices have been discovered see the ‚ÄúIntegrations‚Äù page in your Open Peer Power dashboard. When you click on ‚ÄúConfigure‚Äù you can enter your HomeKit PIN and the device should be added to your Open Peer Power instance. If your device is currently paired with an Apple device via HomeKit, you will need to reset it in order to pair it with Open Peer Power. Once Open Peer Power is configured to work with the device, you can export it back to Siri and Apple Home with the <a href="/integrations/homekit/"><code>HomeKit</code></a> integration.</p>
<h2>Supported devices</h2>
<p>There is currently support for the following device types within Open Peer Power:</p>
<ul>
<li>Alarm Control Panel (HomeKit security system)</li>
<li>Climate (HomeKit thermostats and air conditioners)</li>
<li>Cover (HomeKit garage door openers, windows, or window coverings)</li>
<li>Light (HomeKit lights)</li>
<li>Lock (HomeKit lock)</li>
<li>Switch (HomeKit switches, outlets and valves)</li>
<li>Binary Sensor (HomeKit motion, contact, occupancy and smoke sensors)</li>
<li>Sensor (HomeKit humidity, temperature, co2 and light level sensors)</li>
<li>Fan</li>
<li>Air Quality</li>
</ul>
<p>HomeKit IP accessories for these device types may work with some caveats:</p>
<ul>
<li>If the device is Wi-Fi based and has no physical controls or screen then you may need an Apple HomeKit device like an iPhone or iPad to get the accessory onto your Wi-Fi network. For example, for a Koogeek LS1 you must add the accessory to HomeKit on your iOS device, then remove it from the iOS device. This leaves the LS1 in an unpaired state but still on your Wi-Fi. Open Peer Power can then find it and pair with it.</li>
<li>You need to know the HomeKit PIN. There is no way to recover this if you do not have it. In this case, you will need to contact the manufacturer to see what options you have.</li>
</ul>
<p>HomeKit controller will poll your devices, but it will also automatically enable push updates for accessories that support it.</p>
<p>Open Peer Power does not currently support HomeKit BLE.</p>
<div class='note'>
<p>HomeKit Controller might detect some HomeKit devices on your network that are not currently supported by this integration. One such example is HomeKit displays (such as Vizio TVs which have been updated with HomeKit support). These devices might pair with Open Peer Power if you go through the pairing process, but no entity will be created, and you won‚Äôt be able to control these devices with Open Peer Power. However, pairing the device with Open Peer Power <em>will</em> remove the persistent notification generated when Open Peer Power finds new devices.</p>
</div>
<h2>Troubleshooting</h2>
<h3>I don‚Äôt have a HomeKit PIN</h3>
<p>When you buy a certified HomeKit-enabled device, the PIN might be in the instructions or on a sticker on the accessory itself.</p>
<p>Devices with screens like thermostats may not have PIN codes in the packaging at all. Every time you click on ‚ÄúConfigure‚Äù in the Open Peer Power frontend, your accessory will generate a new pairing code and show it on the display.</p>
<p>If your device doesn‚Äôt have a display and received HomeKit support after it was released, you may not have a pairing code. Dealing with this is manufacturer specific. Some manufacturers allow you to see the pairing code in their iOS app. Others force you to use their app to configure HomeKit and don‚Äôt let you have the pairing pin - right now you won‚Äôt be able to use HomeKit Controller with those devices.</p>
<p>If you have lost your PIN code, then you may not be able to pair your accessory. You should contact the manufacturer to see if there is anything you can do.</p>
<h3>Open Peer Power cannot discover my device</h3>
<p>For IP accessories, Open Peer Power can only find devices that are already on the same network as your device. If an accessory is Wi-Fi based and has no user interface for joining it to your Wi-Fi network, you will need an Apple HomeKit controller device (an iPhone or iPad). You should pair it with the controller and then remove the pairing in the UI (but do not reset the accessory itself). This will leave the accessory on your Wi-Fi network but in an unpaired state, and then Open Peer Power can find it.</p>
<p>Open Peer Power can only find accessories that aren‚Äôt already paired. Even if you reset your Open Peer Power configuration, the accessory will still think it is paired and you won‚Äôt be able to use it with Open Peer Power. You should reset the accessory according to the manufacturer‚Äôs instructions. Some devices have a ‚ÄúReset HomeKit‚Äù option, and some may require a full reset.</p>
<h3>HomeKit controller is finding devices on my network even though I don‚Äôt have any Apple devices</h3>
<p>This is completely normal. Unlike many other commercial IoT offerings, the HomeKit protocol is a local and offline protocol that does not rely on the Apple ecosystem to function. You do not need an Apple online account to use a ‚ÄúWorks with HomeKit‚Äù device. Some Wi-Fi devices may need an iOS device briefly to get them onto your WiFi, but other than that you do not need any Apple hardware on your network.</p>
<p>Many IoT devices are getting a post-launch HomeKit upgrade. This might mean your device starts showing in Open Peer Power as a <code>homekit_controller</code> device even though when you bought it without HomeKit support. This might be a better choice for you than a native integration. For example, many climate devices have an online-only API and a HomeKit API. The HomeKit one might not expose all of the settings and controls you are used to, but it also won‚Äôt break if your Internet connection goes down or the cloud service goes away.</p>
<h3>I have a warning in my logs about HomeKit controller skipping updates</h3>
<p>You may say a log entry that looks like this:</p>
<pre><code class="language-log">HomeKit controller update skipped as previous poll still in flight
</code></pre>
<p>In these cases it‚Äôs unlikely that HomeKit controller itself is directly responsible. This is a safety feature to avoid overloading your Open Peer Power instance. It means that Open Peer Power tried to poll your accessory but the previous poll was still happening. This means it is taking over 1 minute to poll your accessory. This could be caused by a number of things:</p>
<ul>
<li>You have too many blocking synchronous integrations for your Open Peer Power instance. All synchronous integrations share a thread pool, and if there are lots of tasks to run on it they will queued, which will cause delays. In the worst cases this queue can build up faster than it can be emptied. Faster hardware may help, but you may need to disable some integrations.</li>
<li>Your network connection to an accessory is poor and HomeKit Controller is unable to reach the accessory reliably. This will likely require a change to your network setup to improve Wi-Fi coverage or replace damaged cabling.</li>
<li>There is a problem with the accessory itself which is causing intermittent network issues.</li>
</ul>
<p>In these cases, HomeKit Controller will skip polling to avoid a buildup of back pressure in your instance.</p>
:ET