I"æ<p>The <code>dialogflow</code> integration is designed to be used with the <a href="https://dialogflow.com/docs/fulfillment#webhook">webhook</a> integration of <a href="https://dialogflow.com/">Dialogflow</a>. When a conversation ends with a user, Dialogflow sends an action and parameters to the webhook.</p>
<p>To be able to receive messages from Dialogflow, your Open Peer Power instance needs to be accessible from the web and you need to have the <code>base_url</code> configured for the HTTP integration (<a href="/integrations/http/#base_url">documentation</a>). Dialogflow will return fallback answers if your server does not answer or takes too long (more than 5 seconds).</p>
<p>Dialogflow could be <a href="https://dialogflow.com/docs/integrations/">integrated</a> with many popular messaging, virtual assistant and IoT platforms.</p>
<p>Using Dialogflow will be easy to create conversations like:</p>
<p><em>User: What is the temperature at home?</em></p>
<p><em>Bot: The temperature is 34 degrees</em></p>
<p><em>User: Turn on the light</em></p>
<p><em>Bot: In which room?</em></p>
<p><em>User: In the kitchen</em></p>
<p><em>Bot: Turning on kitchen light</em></p>
<p>To use this integration, you should define a conversation (intent) in Dialogflow, configure Open Peer Power with the speech to return and, optionally, the action to execute.</p>
<h3>Configuring your Dialogflow account</h3>
<p>To get the webhook URL, go to the integrations page in the configuration screen and find â€œDialogflowâ€. Click on â€œconfigureâ€. Follow the instructions on the screen.</p>
<ul>
<li><a href="https://console.dialogflow.com/">Login</a> with your Google account</li>
<li>Click on â€œCreate Agentâ€</li>
<li>Select name, language (if you are planning to use Google Actions check their <a href="https://support.google.com/assistant/answer/7108196?hl=en">supported languages</a>) and time zone</li>
<li>Click â€œSaveâ€</li>
<li>Now go to â€œFulfillmentâ€ (in the left menu)</li>
<li>Enable Webhook and set your Dialogflow webhook URL as the endpoint, e.g., <code>https://myhome.duckdns.org/api/webhook/800b4cb4d27d078a8871656a90854a292651b20635685f8ea23ddb7a09e8b417</code></li>
<li>Click â€œSaveâ€</li>
<li>Create a new intent</li>
<li>Below â€œUser saysâ€ write one phrase that you, the user, will tell Dialogflow, e.g., <code>What is the temperature at home?</code></li>
<li>In â€œActionâ€ set some key (this will be the bind with Open Peer Power configuration), e.g.,: GetTemperature</li>
<li>In â€œResponseâ€ set â€œCannot connect to Open Peer Power or it is taking to longâ€ (fall back response)</li>
<li>At the end of the page, click on â€œFulfillmentâ€ and check â€œUse webhookâ€</li>
<li>Click â€œSaveâ€</li>
<li>On the top right, where is written â€œTry it nowâ€¦â€, write, or say, the phrase you have previously defined and hit enter</li>
<li>Dialogflow has send a request to your Open Peer Power server</li>
</ul>
<div class='note warning'>
<p>The V1 API will be deprecated on October 23, 2019. If you are still using the V1 API, it is recommended to change your settings in Dialogflow to use the V2 API. No changes to your intents YAML configuration need to take place after upgrading to the V2 API. Change to the V2 API by clicking on the cog button <a href="https://console.dialogflow.com/">here</a> and then select the V2 API.</p>
</div>
<p>Take a look to â€œIntegrationsâ€, in the left menu, to configure third parties.</p>
<h3>Configuring Open Peer Power</h3>
<p>When activated, the <a href="/integrations/alexa/"><code>alexa</code> integration</a> will have Open Peer Powerâ€™s native intent support handle the incoming intents. If you want to run actions based on intents, use the <a href="/integrations/intent_script"><code>intent_script</code></a> integration.</p>
<h2>Examples</h2>
<p>Download <a href="https://github.com/OpenPeerPower/openpeerpower.io/blob/next/assets/OpenPeerPower_APIAI.zip">this zip</a> and load it in your Dialogflow agent (<strong>Settings</strong> -&gt; <strong>Export and Import</strong>) for examples intents to use with this configuration:</p>
<p>{% highlight yaml %}</p>
<h1>Example configuration.yaml entry</h1>
<p>dialogflow:</p>
<p>intent_script:
Temperature:
speech:
text: The temperature at home is {{ states(â€˜sensor.home_tempâ€™) }} degrees
LocateIntent:
speech:
text: &gt;
{%- for state in states.device_tracker -%}
{%- if state.name.lower() == User.lower() -%}
{{ state.name }} is at {{ state.state }}
{%- elif loop.last -%}
I am sorry, I do not know where {{ User }} is.
{%- endif -%}
{%- else -%}
Sorry, I donâ€™t have any trackers registered.
{%- endfor -%}
WhereAreWeIntent:
speech:
text: &gt;
{%- if is_state(â€˜device_tracker.adriâ€™, â€˜homeâ€™) and
is_state(â€˜device_tracker.beaâ€™, â€˜homeâ€™) -%}
You are both home, you silly
{%- else -%}
Bea is at {{ states(â€œdevice_tracker.beaâ€) }}
and Adri is at {{ states(â€œdevice_tracker.adriâ€) }}
{% endif %}
TurnLights:
speech:
text: Turning {{ Room }} lights {{ OnOff }}
action:
- service: notify.pushbullet
data_template:
message: Someone asked via apiai to turn {{ Room }} lights {{ OnOff }}
- service_template: &gt;
{%- if OnOff == â€œonâ€ -%}
switch.turn_on
{%- else -%}
switch.turn_off
{%- endif -%}
data_template:
entity_id: â€œswitch.light_{{ Room | replace(â€™ â€™, â€˜_â€™) }}â€
{% endhighlight %}</p>
:ET